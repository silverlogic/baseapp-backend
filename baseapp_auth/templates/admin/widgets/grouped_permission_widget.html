<div class="space-y-6">
  <div class="mb-4">
    <input
      type="text"
      class="permission-filter w-full rounded-lg px-3 py-2 text-sm"
      placeholder="Filter permissionsâ€¦"
      aria-label="Filter permissions"
    >
  </div>
  <div class="grouped-permissions space-y-6">
    {% for app_label, models in grouped_permissions.items %}
    <details class="permission-app rounded-xl p-4" open>
      <summary
        class="flex items-center justify-between cursor-default list-none"
      >
        <!-- Left: checkbox + label (NO collapse) -->
        <div
          class="flex items-center gap-2 font-semibold"
          onclick="event.stopPropagation()"
        >
          <input
            type="checkbox"
            class="select-all-app"
          >
          <span>{{ app_label|capfirst }}</span>
        </div>

        <!-- Right: arrow ONLY (collapse control) -->

        <span class="material-symbols-outlined permission-toggle text-gray-500 hover:text-gray-800">
            expand_more
        </span>
      </summary>
      <div class="mt-4 space-y-4">
        {% for model_name, permissions in models.items %}
          <details class="permission-model ml-6" open>
            <summary
              class="flex items-center justify-between cursor-default list-none"
            >
              <div
                class="flex items-center gap-2 text-sm font-medium"
                onclick="event.stopPropagation()"
              >
                <input
                  type="checkbox"
                  class="select-all-model"
                >
                <span>{{ model_name|capfirst }}</span>
              </div>
              <span class="material-symbols-outlined permission-toggle text-gray-500 hover:text-gray-800">
                  expand_more
              </span>
            </summary>
            <ul class="ml-6 mt-2 space-y-1 permission-labels-list">
              {% for perm in permissions %}
                <li>
                  <label
                    class="permission-label flex items-center gap-2 text-sm cursor-pointer"
                  >
                    <input
                      type="checkbox"
                      name="{{ widget.name }}"
                      value="{{ perm.value }}"
                      class="permission-checkbox"
                      {% if perm.checked %}checked{% endif %}
                    >
                    {{ perm.label }}
                  </label>
                </li>
              {% endfor %}
            </ul>
          </details>
        {% endfor %}
      </div>
    </details>
  {% endfor %}
  </div>
</div>